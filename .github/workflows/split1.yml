name: split1
on:
  workflow_dispatch:
  push:
    branches: [ split1 ]
  pull_request:
    branches: [ split1 ]
env:
  RELEASED_ARTIFACTS: toolchain rootfs udeb installer debian
  BUILDER: 1
jobs:
  toolchain:
    name: toolchain
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make -j13 build/toolchain.tar.zstd{artifact}
  libgcc:
    name: libgcc
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make -j13 done/toolchain/gcc/checkout!
    - run: make -j13 done/userspace/glibc/checkout!
    - run: make -j13 done/toolchain/gcc/libgcc/install
    - run: make -j13 build/libgcc.tar.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  qemu:
    name: qemu
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make -j13 build/qemu.tar.zstd{artifact}
  rootfs:
    name: rootfs
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get update
    - run: sudo apt-get -y dist-upgrade
    - run: make -j13 --trace build/debian/debian-rootfs/root2.cpio.zstd{artifact}
  debian:
    name: debian
    runs-on: ubuntu-latest
    needs: [ rootfs ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get update
    - run: sudo apt-get -y dist-upgrade
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: touch build/debian/debian-rootfs/root0.cpio build/debian/debian-rootfs/root1.cpio.gz build/debian/debian-rootfs/root2-script.bash build/debian/debian-rootfs/root2.cpio
    - run: make -j13 build/debian.cpio.zstd{artifact}
      env:
        ARTIFACTS: root2.cpio.zstd
  dplusi:
    name: dplusi
    runs-on: ubuntu-latest
    needs: [ debian, installer ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/debian.cpio.zstd{}
    - run: mkdir -p build/debian/debootstrap
    - run: touch build/debian/debootstrap/stage1.tar
    - run: touch build/debian/debootstrap/stage15.tar
    - run: touch build/debian/debootstrap/stage15.tar
    - run: touch build/debian/debootstrap/stage15.cpio
    - run: touch build/debian/debootstrap/stage2.cpio
    - run: zstd -d < build/artifacts/down/debian.cpio.zstd > build/debian/debian.cpio
    - run: touch build/debian/full-installer.cpio.gz
    - run: touch build/debian/full-installer.cpio
    - run: make build/artifacts/down/installer.cpio.zstd{}
    - run: zstd -d < build/artifacts/down/installer.cpio.zstd > build/debian/installer.cpio
    - run: make -j13 build/dplusi.tar.zstd{artifact}
      env:
        ARTIFACTS: debian.cpio.zstd installer.cpio.zstd
  debian-nobootloader:
    name: debian-nobootloader
    runs-on: ubuntu-latest
    needs: [ rootfs ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: make -j13 --trace build/debian/installer/packages/nobootloader.udeb.zstd{artifact}
  debian-partman-auto:
    name: debian-partman-auto
    runs-on: ubuntu-latest
    needs: [ rootfs ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: make -j13 --trace build/debian/installer/packages/partman-auto.udeb.zstd{artifact}
  debian-user-setup:
    name: debian-user-setup
    runs-on: ubuntu-latest
    needs: [ rootfs ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: make -j13 --trace build/debian/installer/packages/user-setup.udeb.zstd{artifact}
  debian-netcfg-static:
    name: debian-netcfg-static
    runs-on: ubuntu-latest
    needs: [ rootfs ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: make -j13 --trace build/debian/installer/packages/netcfg.udeb.zstd{artifact}
  debian-libdebian-installer:
    name: debian-libdebian-installer
    runs-on: ubuntu-latest
    needs: [ rootfs ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: make -j13 --trace build/debian/installer/packages/libdebian-installer.udeb.zstd{artifact}
  installer:
    name: installer
    runs-on: ubuntu-latest
    needs: [ debian-partman-auto, debian-netcfg-static, debian-user-setup, debian-libdebian-installer, debian-nobootloader ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/root2.cpio.zstd{}
    - run: mkdir -p build/debian/debian-rootfs
    - run: zstd -d < build/artifacts/down/root2.cpio.zstd > build/debian/debian-rootfs/root2.cpio
    - run: mkdir -p build/debian/installer/packages
    - run: make build/artifacts/down/partman-auto.udeb.zstd{}
    - run: zstd -d < build/artifacts/down/partman-auto.udeb.zstd > build/debian/installer/packages/partman-auto.udeb
    - run: make build/artifacts/down/nobootloader.udeb.zstd{}
    - run: zstd -d < build/artifacts/down/nobootloader.udeb.zstd > build/debian/installer/packages/nobootloader.udeb
    - run: make build/artifacts/down/user-setup.udeb.zstd{}
    - run: zstd -d < build/artifacts/down/user-setup.udeb.zstd > build/debian/installer/packages/user-setup-udeb.udeb
    - run: make build/artifacts/down/libdebian-installer.udeb.zstd{}
    - run: zstd -d < build/artifacts/down/libdebian-installer.udeb.zstd > build/debian/installer/packages/libdebian-installer4-udeb.udeb
    - run: make build/artifacts/down/netcfg.udeb.zstd{}
    - run: zstd -d < build/artifacts/down/netcfg.udeb.zstd > build/debian/installer/packages/netcfg-static.udeb
    - run: make -j13 --trace build/debian/installer/installer.cpio.zstd{artifact}
      env:
        ARTIFACTS: partman-auto.udeb.zstd netcfg.udeb.zstd user-setup.udeb.zstd libdebian-installer.udeb.zstd nobootloader.udeb.zstd
  glibc:
    name: glibc
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make -j13 done/userspace/glibc/install
    - run: make -j13 build/glibc.tar.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  emacs:
    name: emacs
    runs-on: ubuntu-latest
    needs: [ glibc ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make -j13 done/userspace/emacs/install
    - run: make -j13 build/emacs.tar.zstd{artifact}
      env:
        ARTIFACTS: glibc.tar.zstd toolchain.tar.zstd
  perl:
    name: perl
    runs-on: ubuntu-latest
    needs: [ glibc ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make -j13 done/userspace/perl/install
    - run: make -j13 build/perl.tar.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd glibc.tar.zstd
  openssl:
    name: openssl
    runs-on: ubuntu-latest
    needs: [ glibc ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make -j13 done/userspace/openssl/install
    - run: make -j13 build/openssl.tar.zstd{artifact}
      env:
        ARTIFACTS: glibc.tar.zstd toolchain.tar.zstd
  busybox:
    name: busybox
    runs-on: ubuntu-latest
    needs: [ glibc ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make -j13 done/userspace/busybox/install
    - run: make -j13 build/busybox.tar.zstd{artifact}
      env:
        ARTIFACTS: glibc.tar.zstd toolchain.tar.zstd
  lvm2:
    name: lvm2
    runs-on: ubuntu-latest
    needs: [ glibc ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make -j13 done/userspace/lvm2/install
    - run: make -j13 build/lvm2.tar.zstd{artifact}
      env:
        ARTIFACTS: glibc.tar.zstd toolchain.tar.zstd
  wpa_supplicant:
    name: wpa_supplicant
    runs-on: ubuntu-latest
    needs: [ glibc ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make -j13 done/userspace/wpa_supplicant/install
    - run: make -j13 build/wpa_supplicant.tar.zstd{artifact}
      env:
        ARTIFACTS: glibc.tar.zstd toolchain.tar.zstd
  rest:
    name: rest
    runs-on: ubuntu-latest
    needs: [ libgcc, emacs, perl, openssl, busybox, lvm2, wpa_supplicant ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/userspace/glibc/checkout
    - run: make build/artifacts/down/libgcc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/libgcc.tar.zstd
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make build/artifacts/down/emacs.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/emacs.tar.zstd
    - run: make build/artifacts/down/perl.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/perl.tar.zstd
    - run: make build/artifacts/down/openssl.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/openssl.tar.zstd
    - run: make build/artifacts/down/busybox.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/busybox.tar.zstd
    - run: make build/artifacts/down/lvm2.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/lvm2.tar.zstd
    - run: make build/artifacts/down/wpa_supplicant.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/wpa_supplicant.tar.zstd
    - run: rm -rf build/userspace/util-linux done/userspace/util-linux
    - run: make -j13 build/rest.tar.zstd{artifact}
      env:
        ARTIFACTS: glibc.tar.zstd toolchain.tar.zstd
  linux_image:
    name: linux.image
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/linux
    - run: make -j13 --trace build/linux/linux.image.zstd{artifact}
    - run: make -j13 --trace build/linux/linux.dtbs.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  linux_modules:
    name: linux.modules
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/linux
    - run: make -j13 --trace build/linux/linux.modules.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  stage2_image:
    name: stage2.image
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/linux
    - run: make -j13 --trace build/linux/stage2.image.zstd{artifact}
    - run: make -j13 --trace build/linux/stage2.dtbs.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  stage2_modules:
    name: stage2.modules
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: rm -rf done/linux
    - run: make -j13 --trace build/linux/stage2.modules.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  bootloaders:
    name: bootloaders
    runs-on: ubuntu-latest
    needs: [ toolchain ]
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/bootloaders.tar.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  pearl:
    name: pearl
    needs: [ rest, linux_image, linux_modules, stage2_image, stage2_modules, bootloaders ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get install libipc-run-perl libfile-slurp-perl device-tree-compiler qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make build/artifacts/down/libgcc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/libgcc.tar.zstd
    - run: make build/artifacts/down/emacs.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/emacs.tar.zstd
    - run: make build/artifacts/down/perl.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/perl.tar.zstd
    - run: make build/artifacts/down/openssl.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/openssl.tar.zstd
    - run: make build/artifacts/down/busybox.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/busybox.tar.zstd
    - run: make build/artifacts/down/lvm2.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/lvm2.tar.zstd
    - run: make build/artifacts/down/wpa_supplicant.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/wpa_supplicant.tar.zstd
    - run: make build/artifacts/down/rest.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/rest.tar.zstd
    - run: mkdir -p build/linux
    - run: make build/artifacts/down/linux.image.zstd{}
    - run: zstd -d < build/artifacts/down/linux.image.zstd > build/linux/linux.image
    - run: make build/artifacts/down/linux.modules.zstd{}
    - run: zstd -d < build/artifacts/down/linux.modules.zstd > build/linux/linux.modules
    - run: make build/artifacts/down/stage2.image.zstd{}
    - run: zstd -d < build/artifacts/down/stage2.image.zstd > build/linux/stage2.image
    - run: make build/artifacts/down/stage2.modules.zstd{}
    - run: zstd -d < build/artifacts/down/stage2.modules.zstd > build/linux/stage2.modules
    - run: make build/artifacts/down/linux.dtbs.zstd{}
    - run: tar -xf build/artifacts/down/linux.dtbs.zstd
    - run: make build/artifacts/down/stage2.dtbs.zstd{}
    - run: tar -xf build/artifacts/down/stage2.dtbs.zstd
    - run: make build/artifacts/down/bootloaders.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/bootloaders.tar.zstd
    - run: touch --reference=done/bootloaders/barebox/configure bootloaders/barebox/barebox.config
    - run: touch --reference=done/bootloaders/u-boot/configure bootloaders/u-boot/u-boot.config
    - run: mkdir -p done/linux/stage2
    - run: mkdir -p done/linux/linux
    - run: make -j13 done/linux/checkout!
    - run: make -j13 done/linux/stage2/copy!
    - run: make -j13 done/linux/linux/copy!
    - run: touch done/linux/linux/configure done/linux/linux/build done/linux/linux/install done/linux/stage2/configure done/linux/stage2/build done/linux/stage2/install build/linux/linux.image build/linux/linux.modules build/linux/stage2.image build/linux/stage2.modules build/linux/*.dtb
    - run: rm -rf done/gcc/checkout
    - run: make zstd/zstd{checkout}
    - run: make -j13 --trace build/pearl.tar.zstd{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd
  pearl-debian:
    name: pearl-debian
    needs: [ pearl, dplusi ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: sudo apt-get update
    - run: sudo apt-get install libipc-run-perl libfile-slurp-perl device-tree-compiler qemu-user qemu-user-static binfmt-support autopoint gettext libtool-bin lzop qemu-system-aarch64
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/artifacts/down/pearl.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/pearl.tar.zstd
    - run: make build/artifacts/down/bootloaders.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/bootloaders.tar.zstd
    - run: make build/artifacts/down/dplusi.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/dplusi.tar.zstd
    - run: make build/artifacts/down/glibc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/glibc.tar.zstd
    - run: make build/artifacts/down/libgcc.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/libgcc.tar.zstd
    - run: touch done/linux/stage2/configure
    - run: touch done/linux/stage2/build
    - run: touch done/linux/linux/configure
    - run: touch done/linux/linux/build
    - run: touch build/linux/pearl.dts.h
    - run: touch build/linux/pearl.cpio
    - run: touch done/linux/pearl/build
    - run: touch build/linux/linux.config
    - run: touch build/linux/linux.modules
    - run: touch build/linux/linux.image
    - run: touch build/linux/stage2.config
    - run: touch build/linux/stage2.modules
    - run: touch build/linux/stage2.image
    - run: touch build/linux/pearl.config
    - run: touch build/initramfs/pearl.cpio
    - run: touch build/linux/pearl.cpio
    - run: touch done/linux/pearl/build
    - run: touch build/linux/pearl.image
    - run: touch build/debian.cpio
    - run: touch build/dplusi.cpio
    - run: make zstd/zstd{checkout}
    - run: make -j13 --trace build/pearl-debian.image{artifact}
      env:
        ARTIFACTS: pearl.tar.zstd dplusi.tar.zstd
  video-uboot:
    name: video-uboot
    needs: [ bootloaders, qemu ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/artifacts/down/bootloaders.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/bootloaders.tar.zstd
    - run: make build/artifacts/down/qemu.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/qemu.tar.zstd
    - run: touch --reference=done/bootloaders/barebox/configure bootloaders/barebox/barebox.config
    - run: touch --reference=done/bootloaders/u-boot/configure bootloaders/u-boot/u-boot.config
    - run: make -j13 --trace build/video/u-boot.mp4{artifact}
  video-barebox:
    name: video-barebox
    needs: [ bootloaders, qemu ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/artifacts/down/bootloaders.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/bootloaders.tar.zstd
    - run: make build/artifacts/down/qemu.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/qemu.tar.zstd
    - run: touch --reference=done/bootloaders/barebox/configure bootloaders/barebox/barebox.config
    - run: touch --reference=done/bootloaders/u-boot/configure bootloaders/u-boot/u-boot.config
    - run: make -j13 --trace build/video/barebox.mp4{artifact}
  video-pearl:
    name: video-pearl
    needs: [ pearl, qemu ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/artifacts/down/pearl.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/pearl.tar.zstd
    - run: make build/artifacts/down/qemu.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/qemu.tar.zstd
    - run: mkdir -p done/linux/stage2
    - run: mkdir -p done/linux/linux
    - run: mkdir -p done/linux/pearl
    - run: mkdir -p build/linux
    - run: make build/artifacts/down/linux.image.zstd{}
    - run: zstd -d < build/artifacts/down/linux.image.zstd > build/linux/linux.image
    - run: make build/artifacts/down/linux.modules.zstd{}
    - run: zstd -d < build/artifacts/down/linux.modules.zstd > build/linux/linux.modules
    - run: make build/artifacts/down/stage2.image.zstd{}
    - run: zstd -d < build/artifacts/down/stage2.image.zstd > build/linux/stage2.image
    - run: make build/artifacts/down/stage2.modules.zstd{}
    - run: zstd -d < build/artifacts/down/stage2.modules.zstd > build/linux/stage2.modules
    - run: touch done/linux/linux/configure done/linux/linux/build done/linux/linux/install done/linux/stage2/configure done/linux/stage2/build done/linux/stage2/install done/linux/pearl/configure done/linux/pearl/build done/linux/pearl/install
    - run: touch build/linux/linux.config
    - run: touch build/linux/stage2.config
    - run: touch build/linux/pearl.config
    - run: touch build/linux/pearl.image
    - run: make -j13 --trace build/video/pearl.mp4{artifact}
  video-debian:
    name: video-debian
    needs: [ pearl-debian, qemu ]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: false
    - name: Set env variables
      uses: ./g/github/env/
    - run: make build/artifacts/down/toolchain.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/toolchain.tar.zstd
    - run: make build/artifacts/down/pearl-debian.image{}
    - run: mv build/artifacts/down/pearl-debian.image build/pearl-debian.image
    - run: make build/artifacts/down/qemu.tar.zstd{}
    - run: tar --skip-old-files -xf build/artifacts/down/qemu.tar.zstd
    - run: make -j13 --trace build/video/pearl-debian.mp4{artifact}
      env:
        ARTIFACTS: toolchain.tar.zstd pearl-debian.image qemu.tar.zstd
